{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\n// Giả sử bạn import file api.js (axios instance) đã tạo ở hoạt động 5\nimport api from \"../api/api\";\n\n// 1. Lấy thông tin user/token từ localStorage (nếu có)\n// Điều này giúp user không bị logout khi F5 trang\nconst user = JSON.parse(localStorage.getItem(\"user\"));\nconst token = localStorage.getItem(\"accessToken\");\n\n// 2. Định nghĩa State ban đầu\nconst initialState = {\n  user: user || null,\n  token: token || null,\n  isAuthenticated: !!token,\n  // true nếu có token, false nếu không\n  status: \"idle\",\n  // 'idle' | 'loading' | 'succeeded' | 'failed'\n  error: null\n};\n\n/* ================================================================\n   3. TẠO THUNK: Logic bất đồng bộ (gọi API)\n   Dùng createAsyncThunk để xử lý việc gọi API login\n================================================================ */\nexport const loginUser = createAsyncThunk(\"auth/login\",\n// Tên của action\nasync (credentials, {\n  rejectWithValue\n}) => {\n  try {\n    // Gọi API login bằng axios instance\n    const response = await api.post(\"/auth/login\", credentials);\n\n    // 4. Lưu vào localStorage\n    localStorage.setItem(\"user\", JSON.stringify(response.data.user));\n    localStorage.setItem(\"accessToken\", response.data.accessToken);\n    localStorage.setItem(\"refreshToken\", response.data.refreshToken);\n\n    // 5. Trả về data (sẽ được lưu vào Redux state)\n    return response.data;\n  } catch (err) {\n    // Nếu API trả về lỗi (ví dụ: 400, 401)\n    return rejectWithValue(err.response.data);\n  }\n});\n\n/* ================================================================\n   6. TẠO SLICE: Nơi chứa state, reducers, và actions\n================================================================ */\nconst authSlice = createSlice({\n  name: \"auth\",\n  initialState,\n  // 7. Reducers: Xử lý các action đồng bộ (synchronous)\n  reducers: {\n    // Action đăng xuất\n    logOut: state => {\n      // Xóa state trong Redux\n      state.user = null;\n      state.token = null;\n      state.isAuthenticated = false;\n      // Xóa state trong localStorage\n      localStorage.removeItem(\"user\");\n      localStorage.removeItem(\"accessToken\");\n      localStorage.removeItem(\"refreshToken\");\n    }\n  },\n  // 8. ExtraReducers: Xử lý các action bất đồng bộ (từ Thunk)\n  extraReducers: builder => {\n    builder\n    // Xử lý khi 'loginUser' đang chạy\n    .addCase(loginUser.pending, state => {\n      state.status = \"loading\";\n      state.error = null;\n    })\n    // Xử lý khi 'loginUser' thành công\n    .addCase(loginUser.fulfilled, (state, action) => {\n      state.status = \"succeeded\";\n      state.isAuthenticated = true;\n      state.user = action.payload.user;\n      state.token = action.payload.accessToken;\n    })\n    // Xử lý khi 'loginUser' thất bại\n    .addCase(loginUser.rejected, (state, action) => {\n      state.status = \"failed\";\n      state.isAuthenticated = false;\n      state.user = null;\n      state.token = null;\n      state.error = action.payload.message || \"Đăng nhập thất bại\";\n    });\n  }\n});\n\n// 9. Export các actions và reducer\nexport const {\n  logOut\n} = authSlice.actions;\n\n// Selector (giúp lấy state dễ dàng hơn trong component)\nexport const selectIsAuthenticated = state => state.auth.isAuthenticated;\nexport const selectUser = state => state.auth.user;\nexport const selectAuthStatus = state => state.auth.status;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","api","user","JSON","parse","localStorage","getItem","token","initialState","isAuthenticated","status","error","loginUser","credentials","rejectWithValue","response","post","setItem","stringify","data","accessToken","refreshToken","err","authSlice","name","reducers","logOut","state","removeItem","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","message","actions","selectIsAuthenticated","auth","selectUser","selectAuthStatus","reducer"],"sources":["/Users/wocten/Documents/group2-project/frontend/src/redux/authSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\n// Giả sử bạn import file api.js (axios instance) đã tạo ở hoạt động 5\nimport api from \"../api/api\"; \n\n// 1. Lấy thông tin user/token từ localStorage (nếu có)\n// Điều này giúp user không bị logout khi F5 trang\nconst user = JSON.parse(localStorage.getItem(\"user\"));\nconst token = localStorage.getItem(\"accessToken\");\n\n// 2. Định nghĩa State ban đầu\nconst initialState = {\n  user: user || null,\n  token: token || null,\n  isAuthenticated: !!token, // true nếu có token, false nếu không\n  status: \"idle\", // 'idle' | 'loading' | 'succeeded' | 'failed'\n  error: null,\n};\n\n/* ================================================================\n   3. TẠO THUNK: Logic bất đồng bộ (gọi API)\n   Dùng createAsyncThunk để xử lý việc gọi API login\n================================================================ */\nexport const loginUser = createAsyncThunk(\n  \"auth/login\", // Tên của action\n  async (credentials, { rejectWithValue }) => {\n    try {\n      // Gọi API login bằng axios instance\n      const response = await api.post(\"/auth/login\", credentials);\n      \n      // 4. Lưu vào localStorage\n      localStorage.setItem(\"user\", JSON.stringify(response.data.user));\n      localStorage.setItem(\"accessToken\", response.data.accessToken);\n      localStorage.setItem(\"refreshToken\", response.data.refreshToken);\n\n      // 5. Trả về data (sẽ được lưu vào Redux state)\n      return response.data;\n\n    } catch (err) {\n      // Nếu API trả về lỗi (ví dụ: 400, 401)\n      return rejectWithValue(err.response.data);\n    }\n  }\n);\n\n/* ================================================================\n   6. TẠO SLICE: Nơi chứa state, reducers, và actions\n================================================================ */\nconst authSlice = createSlice({\n  name: \"auth\",\n  initialState,\n  \n  // 7. Reducers: Xử lý các action đồng bộ (synchronous)\n  reducers: {\n    // Action đăng xuất\n    logOut: (state) => {\n      // Xóa state trong Redux\n      state.user = null;\n      state.token = null;\n      state.isAuthenticated = false;\n      // Xóa state trong localStorage\n      localStorage.removeItem(\"user\");\n      localStorage.removeItem(\"accessToken\");\n      localStorage.removeItem(\"refreshToken\");\n    },\n  },\n  \n  // 8. ExtraReducers: Xử lý các action bất đồng bộ (từ Thunk)\n  extraReducers: (builder) => {\n    builder\n      // Xử lý khi 'loginUser' đang chạy\n      .addCase(loginUser.pending, (state) => {\n        state.status = \"loading\";\n        state.error = null;\n      })\n      // Xử lý khi 'loginUser' thành công\n      .addCase(loginUser.fulfilled, (state, action) => {\n        state.status = \"succeeded\";\n        state.isAuthenticated = true;\n        state.user = action.payload.user;\n        state.token = action.payload.accessToken;\n      })\n      // Xử lý khi 'loginUser' thất bại\n      .addCase(loginUser.rejected, (state, action) => {\n        state.status = \"failed\";\n        state.isAuthenticated = false;\n        state.user = null;\n        state.token = null;\n        state.error = action.payload.message || \"Đăng nhập thất bại\";\n      });\n  },\n});\n\n// 9. Export các actions và reducer\nexport const { logOut } = authSlice.actions;\n\n// Selector (giúp lấy state dễ dàng hơn trong component)\nexport const selectIsAuthenticated = (state) => state.auth.isAuthenticated;\nexport const selectUser = (state) => state.auth.user;\nexport const selectAuthStatus = (state) => state.auth.status;\n\nexport default authSlice.reducer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}