{"ast":null,"code":"var _jsxFileName = \"/Users/wocten/Documents/group2-project/frontend/src/UploadAvatar.jsx\",\n  _s = $RefreshSig$();\n// frontend/src/UploadAvatar.jsx\n\nimport React, { useState } from \"react\";\n// ⛔️ import axios from \"axios\";\nimport api from \"./api\"; // ✅ 1. Dùng instance 'api' có interceptor\nimport { useNavigate } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction UploadAvatar() {\n  _s();\n  const [file, setFile] = useState(null);\n  const [preview, setPreview] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const navigate = useNavigate();\n  const handleFileChange = e => {\n    const selectedFile = e.target.files[0];\n    setFile(selectedFile);\n    // Xem trước ảnh\n    if (selectedFile) {\n      setPreview(URL.createObjectURL(selectedFile));\n    }\n  };\n  const handleUpload = async e => {\n    e.preventDefault();\n    if (!file) return setMessage(\"❌ Vui lòng chọn ảnh!\");\n\n    // ⛔️ 2. KHÔNG CẦN LẤY TOKEN HAY SET HEADER THỦ CÔNG\n    // const token = localStorage.getItem(\"token\"); \n    // if (!token) return setMessage(\"❌ Bạn chưa đăng nhập\");\n    // Interceptor trong 'api.js' sẽ tự động lấy 'accessToken' và đính kèm\n\n    const formData = new FormData();\n    formData.append(\"avatar\", file);\n    try {\n      // ✅ 3. Dùng 'api' và sửa đường dẫn\n      // 'api.js' đã có baseURL là \"http://localhost:3000/api\"\n      // server.js của bạn mount route này ở \"/api/users\"\n      // Nên đường dẫn gọi chỉ cần là \"/users/upload-avatar\"\n      const res = await api.post(\"/users/upload-avatar\", formData\n      // ⛔️ Không cần 'headers', axios tự set 'multipart/form-data'\n      // và interceptor tự set 'Authorization'\n      );\n      setMessage(\"✅ \" + res.data.message);\n      setPreview(res.data.avatar); // Cập nhật ảnh preview bằng link cloudinary\n      setFile(null); // Xóa file đã chọn\n\n      // ✅ 4. Cập nhật lại user trong localStorage\n      localStorage.setItem(\"user\", JSON.stringify(res.data.user));\n    } catch (err) {\n      var _err$response, _err$response$data;\n      // Interceptor sẽ tự xử lý 401, đây là các lỗi khác (400, 500)\n      setMessage(\"❌ \" + (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || \"Lỗi upload ảnh!\"));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: styles.container,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: styles.card,\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: styles.title,\n        children: \"C\\u1EADp nh\\u1EADt \\u1EA3nh \\u0111\\u1EA1i di\\u1EC7n\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 63,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleUpload,\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          accept: \"image/*\",\n          onChange: handleFileChange,\n          style: {\n            width: \"100%\",\n            boxSizing: \"border-box\",\n            marginBottom: \"15px\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 11\n        }, this), preview && /*#__PURE__*/_jsxDEV(\"img\", {\n          src: preview,\n          alt: \"preview\",\n          style: styles.preview\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 23\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          style: styles.btnSubmit,\n          children: \"T\\u1EA3i l\\xEAn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 9\n      }, this), message && /*#__PURE__*/_jsxDEV(\"p\", {\n        style: styles.message,\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        style: {\n          ...styles.btnSubmit,\n          background: \"#ccc\",\n          color: \"#333\",\n          marginTop: \"10px\"\n        },\n        onClick: () => navigate(-1) // Dùng navigate(-1) để quay lại trang trước\n        ,\n        children: \"Quay l\\u1EA1i\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 61,\n    columnNumber: 5\n  }, this);\n}\n\n// ... (styles giữ nguyên)\n_s(UploadAvatar, \"BO7UMhbiGmTPzt1ea200kzC9r+Q=\", false, function () {\n  return [useNavigate];\n});\n_c = UploadAvatar;\nconst styles = {\n  container: {\n    background: \"linear-gradient(135deg,#c2e9fb,#a1c4fd)\",\n    height: \"100vh\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  card: {\n    background: \"#fff\",\n    padding: \"40px\",\n    borderRadius: \"20px\",\n    width: \"380px\",\n    textAlign: \"center\",\n    boxShadow: \"0 8px 25px rgba(0,0,0,0.15)\"\n  },\n  title: {\n    fontSize: \"26px\",\n    marginBottom: \"25px\"\n  },\n  preview: {\n    width: \"120px\",\n    height: \"120px\",\n    borderRadius: \"50%\",\n    objectFit: \"cover\",\n    margin: \"15px auto\"\n  },\n  message: {\n    fontSize: \"14px\",\n    marginTop: \"15px\"\n  },\n  btnSubmit: {\n    width: \"100%\",\n    padding: \"12px 14px\",\n    background: \"linear-gradient(135deg,#4facfe,#00f2fe)\",\n    color: \"white\",\n    border: \"none\",\n    borderRadius: \"12px\",\n    fontSize: \"16px\",\n    cursor: \"pointer\",\n    fontWeight: \"600\",\n    marginTop: \"15px\"\n  }\n};\nexport default UploadAvatar;\nvar _c;\n$RefreshReg$(_c, \"UploadAvatar\");","map":{"version":3,"names":["React","useState","api","useNavigate","jsxDEV","_jsxDEV","UploadAvatar","_s","file","setFile","preview","setPreview","message","setMessage","navigate","handleFileChange","e","selectedFile","target","files","URL","createObjectURL","handleUpload","preventDefault","formData","FormData","append","res","post","data","avatar","localStorage","setItem","JSON","stringify","user","err","_err$response","_err$response$data","response","style","styles","container","children","card","title","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","type","accept","onChange","width","boxSizing","marginBottom","src","alt","btnSubmit","background","color","marginTop","onClick","_c","height","display","alignItems","justifyContent","padding","borderRadius","textAlign","boxShadow","fontSize","objectFit","margin","border","cursor","fontWeight","$RefreshReg$"],"sources":["/Users/wocten/Documents/group2-project/frontend/src/UploadAvatar.jsx"],"sourcesContent":["// frontend/src/UploadAvatar.jsx\n\nimport React, { useState } from \"react\";\n// ⛔️ import axios from \"axios\";\nimport api from \"./api\"; // ✅ 1. Dùng instance 'api' có interceptor\nimport { useNavigate } from \"react-router-dom\"; \n\nfunction UploadAvatar() {\n  const [file, setFile] = useState(null);\n  const [preview, setPreview] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const navigate = useNavigate(); \n\n  const handleFileChange = (e) => {\n    const selectedFile = e.target.files[0];\n    setFile(selectedFile);\n    // Xem trước ảnh\n    if (selectedFile) {\n        setPreview(URL.createObjectURL(selectedFile));\n    }\n  };\n\n  const handleUpload = async (e) => {\n    e.preventDefault();\n    if (!file) return setMessage(\"❌ Vui lòng chọn ảnh!\");\n\n    // ⛔️ 2. KHÔNG CẦN LẤY TOKEN HAY SET HEADER THỦ CÔNG\n    // const token = localStorage.getItem(\"token\"); \n    // if (!token) return setMessage(\"❌ Bạn chưa đăng nhập\");\n    // Interceptor trong 'api.js' sẽ tự động lấy 'accessToken' và đính kèm\n\n    const formData = new FormData();\n    formData.append(\"avatar\", file);\n\n    try {\n      // ✅ 3. Dùng 'api' và sửa đường dẫn\n      // 'api.js' đã có baseURL là \"http://localhost:3000/api\"\n      // server.js của bạn mount route này ở \"/api/users\"\n      // Nên đường dẫn gọi chỉ cần là \"/users/upload-avatar\"\n      const res = await api.post(\n        \"/users/upload-avatar\", \n        formData\n        // ⛔️ Không cần 'headers', axios tự set 'multipart/form-data'\n        // và interceptor tự set 'Authorization'\n      );\n      \n      setMessage(\"✅ \" + res.data.message);\n      setPreview(res.data.avatar); // Cập nhật ảnh preview bằng link cloudinary\n      setFile(null); // Xóa file đã chọn\n\n      // ✅ 4. Cập nhật lại user trong localStorage\n      localStorage.setItem(\"user\", JSON.stringify(res.data.user));\n\n    } catch (err) {\n      // Interceptor sẽ tự xử lý 401, đây là các lỗi khác (400, 500)\n      setMessage(\"❌ \" + (err.response?.data?.message || \"Lỗi upload ảnh!\"));\n    }\n  };\n\n  return (\n    <div style={styles.container}>\n      <div style={styles.card}>\n        <h2 style={styles.title}>Cập nhật ảnh đại diện</h2>\n\n        <form onSubmit={handleUpload}>\n          <input\n            type=\"file\"\n            accept=\"image/*\"\n            onChange={handleFileChange}\n            style={{ width: \"100%\", boxSizing: \"border-box\", marginBottom: \"15px\" }}\n          />\n          {preview && <img src={preview} alt=\"preview\" style={styles.preview} />}\n          <button type=\"submit\" style={styles.btnSubmit}>Tải lên</button>\n        </form>\n\n        {message && <p style={styles.message}>{message}</p>}\n\n        {/* Nút quay lại */}\n        <button \n          style={{ ...styles.btnSubmit, background: \"#ccc\", color: \"#333\", marginTop: \"10px\" }}\n          onClick={() => navigate(-1)} // Dùng navigate(-1) để quay lại trang trước\n        >\n           Quay lại\n        </button>\n      </div>\n    </div>\n  );\n}\n\n// ... (styles giữ nguyên)\nconst styles = {\n  container: { background: \"linear-gradient(135deg,#c2e9fb,#a1c4fd)\", height: \"100vh\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\" },\n  card: { background: \"#fff\", padding: \"40px\", borderRadius: \"20px\", width: \"380px\", textAlign: \"center\", boxShadow: \"0 8px 25px rgba(0,0,0,0.15)\" },\n  title: { fontSize: \"26px\", marginBottom: \"25px\" },\n  preview: { width: \"120px\", height: \"120px\", borderRadius: \"50%\", objectFit: \"cover\", margin: \"15px auto\" },\n  message: { fontSize: \"14px\", marginTop: \"15px\" },\n  btnSubmit: {\n    width: \"100%\", padding: \"12px 14px\",\n    background: \"linear-gradient(135deg,#4facfe,#00f2fe)\",\n    color: \"white\", border: \"none\", borderRadius: \"12px\",\n    fontSize: \"16px\", cursor: \"pointer\", fontWeight: \"600\",\n    marginTop: \"15px\"\n  }\n};\n\nexport default UploadAvatar;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}